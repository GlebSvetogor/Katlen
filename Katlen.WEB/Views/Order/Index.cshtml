@model Katlen.WEB.ViewModels.OrderViewModel;

<hr>

<main>
    <section class="order">
        <div class="container">
            <h1 class="order__title fut-b">
                Оформить заявку
            </h1>
            <div class="order__check">
                <p class="text order__check-text order__check-text--active m-0 fut-b">Я зарегестрирован</p>
                <p class="text order__check-text m-0 fut-b">Новый покупатель</p>
            </div>
            <div class="order__inner">
                <div class="order__inner-item">
                    <img src="~/images/01.png" alt="first img" class="order__inner-num">
                    <div class="order__inner-content">
                        <h3 class="order__inner-title fut-m">Контактная информация</h3>
                        <form action="" class="order__inner-form" id="contactForm">
                            <div class="order__headline">
                                <input type="text" class="window__input order__input" placeholder="Имя" id="firstName">
                                <input type="text" class="window__input order__input" placeholder="Фамилия" id="lastName">
                                <input type="text" class="window__input order__input" placeholder="Телефон" id="phone">
                            </div>
                            <input type="text" class="window__input order__input" placeholder="Email" id="email">
                        </form>
                    </div>
                </div>

                <hr>

                <div class="order__inner-item">
                    <img src="~/images/02.png" alt="second img" class="order__inner-num">
                    <div class="order__inner-content">
                        <h3 class="order__inner-title fut-b">Способ доставки</h3>
                        <form action="" class="order__inner-form" id="deliveryForm">
                            <div class="order__place">
                                <div class="order__place-region">
                                    <div class="order__place-item">
                                        <label for="region">Область</label>
                                        <input id="region" type="text" class="window__input order__input">
                                    </div>
                                    <div class="order__place-item">
                                        <label for="city">Город</label>
                                        <input id="city" type="text" class="window__input order__input">
                                    </div>
                                </div>
                                <div class="order__place-address">
                                    <div class="order__place-item">
                                        <label for="street">Улица</label>
                                        <input id="street" type="text" class="window__input order__input">
                                    </div>
                                    <div class="order__place-item">
                                        <label for="house">Дом</label>
                                        <input id="house" type="text" class="window__input order__input">
                                    </div>
                                    <div class="order__place-item">
                                        <label for="float">Квартира</label>
                                        <input id="float" type="text" class="window__input order__input">
                                    </div>
                                    <div class="order__place-item">
                                        <label for="index">Индекс</label>
                                        <input id="index" type="text" class="window__input order__input">
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <hr>

                <div class="order__inner-item">
                    <img src="~/images/03.png" alt="third img" class="order__inner-num">
                    <div class="order__inner-box">
                        <div class="order__inner-content">
                            <h3 class="order__inner-title fut-b">Способ оплаты</h3>
                            <form action="" class="order__pay-form" id="paymentForm">
                                <div class="order__pay-item">
                                    <input id="bank" type="checkbox" class="order__checkbox">
                                    <label class="order__checkbox-label fut-m" for="bank">Банковская карта</label>
                                </div>
                                <div class="order__pay-item">
                                    <input id="money" type="checkbox" class="order__checkbox">
                                    <label class="order__checkbox-label fut-m" for="money">Наличными при получении</label>
                                </div>
                                <div class="order__pay-item">
                                    <input id="cash" type="checkbox" class="order__checkbox">
                                    <label class="order__checkbox-label fut-m" for="cash">Наличными при получении</label>
                                </div>
                            </form>
                        </div>
                        <hr>
                        <div class="order__products">
                            <h3 class="order__inner-title fut-b">Товары</h3>
                            <div class="product__card">

                                @foreach(var pr in Model.Basket)
                                {

                                    <div class="product__card-item">
                                        <div class="product__card-info">
                                            <div class="product__card-wrapper">
                                                <img src="@pr.Image" alt="product img" class="product__card-img">
                                            </div>
                                            <div class="product__card-content">
                                                <h3 class="order__inner-title fut-l">@pr.Name</h3>
                                                <ul class="products__item-list">
                                                    <li class="products__item-content">
                                                        <span class="products__item-tall">Размер</span>
                                                        <hr>
                                                        <span class="products__item-value fut-m ">@pr.Size</span>
                                                    </li>
                                                    <li class="products__item-content products__without-line">
                                                        <span class="products__item-tissue">Ткань</span>
                                                        <span class="products__item-value fut-m">@pr.Material</span>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <div class="product__card-price">
                                            <div class="product__card-quality">
                                                <h3 class="order__inner-title fut-l">Количество</h3>
                                                <input class="cards__item-input m-0" min="1" max="99" value="@pr.Quality" type="number">
                                            </div>
                                            <div class="product__main-price">
                                                <h3 class="order__inner-title fut-l">Цена</h3>
                                                <div class="product__main-sale">
                                                    <span class="products__full-price fut-b">
                                                        @pr.FullPrice руб.
                                                        <svg class="cross-line" xmlns="http://www.w3.org/2000/svg" width="62" height="18" viewBox="0 0 62 18" fill="none">
                                                            <path d="M61 1L1 17" stroke="#FF003D" data-darkreader-inline-stroke="" style="--darkreader-inline-stroke: #ff1a50;"></path>
                                                        </svg>
                                                    </span>
                                                    <span class="products__sale-value fut-b">@pr.SalePrice руб.</span>
                                                </div>
                                            </div><!-- /. product__main-price -->
                                        </div>
                                        <img src="~/images/TrashCan-img.png" alt="trash can img" class="product__card-can">
                                    </div><!-- /. product__card-item -->
                                    
                                }

                            </div>
                            <div class="order__request">
                                <ul class="products__item-list order__final-list">
                                    <li class="products__item-content order__final-item">
                                        <span class="products__item-price fut-l">Цена:</span>
                                        <span class="products__sale-value fut-b">@Model.TotalFullPrice руб.</span>
                                    </li>
                                    <li class="products__item-content order__final-item">
                                        <span class="products__item-price fut-l">Скидка:</span>
                                        <span class="products__sale-value fut-l">@Model.TotalSale руб.</span>
                                    </li>
                                    <li class="products__item-content order__final-item">
                                        <span class="products__item-price fut-b">Итого:</span>
                                        <span class="products__sale-value fut-b">@Model.TotalPrice руб.</span>
                                    </li>
                                </ul>
                                <button class="but-link fut-b m-0" id="submitOrder">Оформить заказ</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>
</main>

<script>
    $(document).ready(function () {

        document.getElementById('submitOrder').addEventListener('click', function() {
            // Собираем данные с первой формы
            const contactData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value
            };

            // Собираем данные со второй формы
            const deliveryData = {
                region: document.getElementById('region').value,
                city: document.getElementById('city').value,
                street: document.getElementById('street').value,
                house: document.getElementById('house').value,
                float: document.getElementById('float').value,
                index: document.getElementById('index').value
            };

            // Собираем данные с третьей формы
            const paymentData = {
                bank: document.getElementById('bank').checked,
                money: document.getElementById('money').checked,
                cash: document.getElementById('cash').checked
            };

            // Объединяем все данные в одну модель
            const orderRequestModel = {
                contactData,
                deliveryData,
                paymentData
            };

            // Отправляем данные на сервер через AJAX (используем fetch)
            fetch('/Order/Request', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(orderRequestModel)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                // Дополнительные действия при успешной отправке данных
            })
            .catch((error) => {
                console.error('Error:', error);
                // Дополнительные действия при ошибке
            });
        });

    })

</script>